<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Local Explorer</title>

  <!-- Manifest & icons -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />
  <meta name="theme-color" content="#111827" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Raleway:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Load API keys -->
  <script src="keys.js"></script>

  <style>
    :root {
      --background: #f5f5f2;
      --card: #061f3e;
      --primary: #e95420;
      --secondary: #0a324a;
      --text-dark: #061f3e;
      --text-light: #ffffff;
      --accent: #b38a5e;
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Raleway', sans-serif;
      background-color: var(--background);
      color: var(--text-dark);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      overscroll-behavior: contain;
    }
    h1,h2,h3 { font-family: 'Poppins', sans-serif; margin: 0; }
    h1 {
      font-size: 1.8rem;
      color: var(--card);
      text-align: center;
      padding: 1rem 0;
      letter-spacing: 0.05rem;
      text-transform: uppercase;
      font-weight: 700;
      border-bottom: 3px solid var(--accent);
    }
    #locationDisplay {
      text-align: center;
      margin-bottom: .5rem;
      font-size: .95rem;
      color: var(--card);
      font-weight: 500;
      letter-spacing: .02rem;
    }
    #manualInputContainer {
      display: none;
      margin: .5rem auto;
      max-width: 90%;
    }
    #manualInputContainer input {
      width: 100%;
      padding: .6rem;
      border-radius: var(--radius);
      border: 1px solid var(--accent);
      font-size: 1rem;
      background-color: var(--background);
      color: var(--card);
      outline: none;
    }
    /* Fact widget */
    #factWidget {
      background-color: var(--secondary);
      color: var(--text-light);
      margin: .5rem auto;
      padding: .75rem 1rem;
      border-radius: var(--radius);
      max-width: 90%;
      min-height: 80px;
      border: 2px dashed var(--accent);
      position: relative;
      overflow: hidden;
      font-size: .95rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      box-shadow: 0 4px 12px rgba(0,0,0,.18);
    }
    #factHeader {
      display: flex; justify-content: space-between; align-items: center;
      width: 100%; margin-bottom: .3rem;
    }
    #factHeader #factTitle {
      font-size: .95rem;
      font-family: 'Poppins', sans-serif;
      color: var(--text-light);
      letter-spacing: .03rem;
    }
    #toggleFacts {
      background: none; border: none; color: var(--text-light);
      font-size: 1.1rem; cursor: pointer;
      transition: transform .3s ease;
    }
    #toggleFacts.rotated { transform: rotate(180deg); }

    #factDeck { position: relative; width: 100%; overflow: hidden; padding: 0 1.5rem; }
    #factCardsWrapper { display: flex; transition: transform .4s ease; width: 100%; }
    .fact-card {
      flex-shrink: 0; width: 100%; padding: .7rem 1rem;
      background-color: var(--card); color: var(--text-light);
      border: 2px solid var(--accent); border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,.4);
      line-height: 1.4; font-size: .9rem; text-align: center;
    }
    .nav-btn {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: var(--secondary); color: var(--text-light);
      border: 1px solid var(--accent); border-radius: 50%;
      width: 32px; height: 32px; display: flex;
      align-items: center; justify-content: center;
      cursor: pointer; opacity: .85; z-index: 5;
      box-shadow: 0 2px 6px rgba(0,0,0,.3);
    }
    #prevFact { left: .25rem; }
    #nextFact { right: .25rem; }
    #factWidget.collapsed #factDeck { display: none; }

    /* Filter grid */
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px,1fr));
      gap: .5rem; max-width: 90%; margin: 1rem auto;
    }
    .filter-btn {
      background-color: var(--card); color: var(--text-light);
      border: 1px solid var(--accent);
      border-radius: var(--radius); padding: .75rem;
      font-size: 1rem; display: flex; align-items: center;
      justify-content: center; gap: .5rem;
      cursor: pointer;
      transition: transform .1s ease, background-color .2s ease;
    }
    .filter-btn:active { transform: scale(.96); background-color: var(--secondary); }
    .support-btn {
      background: linear-gradient(145deg,#48586b,#7b8b9e);
      color: var(--text-light); border: 1px solid #a4b0bc;
      box-shadow: inset 1px 1px 2px rgba(255,255,255,.3),
                  inset -2px -2px 3px rgba(0,0,0,.4);
    }

    #primaryActions { max-width: 90%; margin: 1rem auto; display: flex; flex-direction: column; gap: .5rem; }
    #myListBtn, #myPlanBtn, #surpriseBtn {
      border: none; border-radius: var(--radius); font-size: 1rem;
      padding: .8rem; cursor: pointer; display: flex;
      align-items: center; justify-content: center; gap: .5rem;
    }
    #myListBtn, #myPlanBtn {
      background-color: var(--secondary);
      color: var(--text-light);
      border: 1px solid var(--accent);
    }
    #surpriseBtn {
      background-color: var(--primary);
      color: var(--text-light);
      font-weight: 600;
      border: 1px solid var(--primary);
    }

    #ghostBtn {
      position: fixed; bottom: 1rem; left: 1rem;
      background: transparent; border: none;
      font-size: 2.2rem; opacity: .4; cursor: pointer;
      transition: opacity .2s, transform .3s; z-index: 30;
    }
    #ghostBtn:hover { opacity: 1; transform: rotate(5deg); }

    /* Modals */
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,.6); display: none;
      flex-direction: column; align-items: center; justify-content: center;
      z-index: 20;
    }
    .modal.active { display: flex; backdrop-filter: blur(2px); }
    body.modal-open { overflow: hidden; }

    .modal-content {
      background-color: var(--background);
      border-radius: var(--radius);
      max-height: 80vh; overflow-y: auto; width: 92%;
      box-shadow: 0 4px 14px rgba(0,0,0,.25);
      padding: 1rem; position: relative;
      border: 2px solid var(--accent);
      transform: scale(.95) translateY(20px);
      transition: transform .3s ease;
    }
    .modal.active .modal-content { transform: scale(1) translateY(0); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .close-btn {
      background: none; border: none; font-size: 1.5rem;
      cursor: pointer; color: var(--card); padding: .2rem;
    }

    .subMenuList button, .results-list button {
      width: 100%; background: var(--card); color: var(--text-light);
      border: none; border-radius: var(--radius);
      padding: .75rem; font-size: .9rem;
      display: flex; justify-content: space-between;
      align-items: center; margin-bottom: .5rem; cursor: pointer;
      transition: background-color .2s;
    }
    .special-btn { background: var(--primary); color: var(--text-light); font-weight: 600; }
    .subMenuList button:hover, .results-list button:hover { background: #1e293b; }
    .results-item { display: flex; gap: .75rem; }
    .results-item img {
      width: 60px; height: 60px; object-fit: cover;
      border-radius: var(--radius); flex-shrink: 0;
    }
    .results-info { flex-grow: 1; display: flex; flex-direction: column; }
    .results-info h4 { margin: 0; font-family: 'Poppins', sans-serif; font-size: 1rem; color: var(--text-light); letter-spacing: .03rem; }
    .results-info .rating { font-size: .8rem; color: #fbbf24; }
  </style>
</head>
<body>
  <h1>Local Explorer</h1>
  <div id="locationDisplay">Detecting your location‚Ä¶</div>

  <div id="manualInputContainer">
    <input id="manualLocation" placeholder="Enter a city or place‚Ä¶" />
  </div>

  <!-- Fact widget -->
  <div id="factWidget">
    <div id="factHeader">
      <span id="factTitle">Local Facts</span>
      <button id="toggleFacts">‚ñº</button>
    </div>
    <div id="factDeck">
      <button id="prevFact" class="nav-btn">‚óÄ</button>
      <div id="factCardsWrapper">
        <div class="fact-card">Discovering quirky facts about your area‚Ä¶</div>
      </div>
      <button id="nextFact" class="nav-btn">‚ñ∂</button>
    </div>
  </div>

  <!-- Filters / categories -->
  <div class="filters" id="filterContainer">
    <button class="filter-btn" data-type="restaurant">üçΩÔ∏è Eats</button>
    <button class="filter-btn" data-type="cafe">‚òï Caf√©s</button>
    <button class="filter-btn" data-type="park">üå≥ Parks</button>
    <button class="filter-btn" data-type="museum">üèõÔ∏è Museums</button>
    <button class="filter-btn" data-type="shopping_mall">üõçÔ∏è Shops</button>
    <button class="filter-btn" data-type="tourist_attraction">üì∏ Attractions</button>
    <button class="filter-btn support-btn" id="supportBtn">üíñ Support Us</button>
  </div>

  <!-- Main action buttons -->
  <div id="primaryActions">
    <button id="myListBtn">üìÇ My List</button>
    <button id="myPlanBtn">üóìÔ∏è My Plan</button>
    <button id="surpriseBtn">üé≤ Surprise Me</button>
  </div>

  <!-- Ghost button (hidden fun menu) -->
  <button id="ghostBtn">üëª</button>

  <!-- Result screen -->
  <div id="resultsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Nearby Results</h3>
        <button class="close-btn" id="closeResults">‚úï</button>
      </div>
      <div class="results-list" id="resultsList"></div>
    </div>
  </div>

  <!-- Details modal -->
  <div id="detailsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="detailTitle">Details</h3>
        <button class="close-btn" id="closeDetails">‚úï</button>
      </div>
      <div id="detailBody"></div>
    </div>
  </div>

  <!-- My List modal -->
  <div id="myListModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>My List</h3>
        <button class="close-btn" id="closeMyList">‚úï</button>
      </div>
      <div id="myListContainer"></div>
    </div>
  </div>

  <!-- My Plan modal -->
  <div id="myPlanModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>My Plan</h3>
        <button class="close-btn" id="closeMyPlan">‚úï</button>
      </div>
      <div id="myPlanContainer"></div>
    </div>
  </div>

  <!-- Support modal -->
  <div id="supportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Support Local Explorer</h3>
        <button class="close-btn" id="closeSupport">‚úï</button>
      </div>
      <p style="text-align:center;margin-bottom:.5rem;">
        If you enjoy Local Explorer, consider a small tip ‚öì
      </p>
      <p style="text-align:center;">
        <a href="https://venmo.com/u/Stephen-Mohamed-1" target="_blank"
           style="color:#e95420;font-weight:600;text-decoration:none;">@Stephen-Mohamed-1 on Venmo</a>
      </p>
    </div>
  </div>

  <!-- Ghost menu (hidden) -->
  <div id="ghostMenu" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üëª Ghost Menu</h3>
        <button class="close-btn" id="closeGhost">‚úï</button>
      </div>
      <div class="subMenuList" id="ghostList">
        <button data-action="about">‚ÑπÔ∏è About Local Explorer</button>
        <button data-action="theme">üåì Toggle Theme</button>
        <button data-action="reset">‚ôªÔ∏è Reset App Data</button>
      </div>
    </div>
  </div>
  <script>
    const LocalExplorer = {
      map: null,
      service: null,
      pos: null,
      places: [],
      facts: [],
      currentFact: 0,
      savedList: JSON.parse(localStorage.getItem('savedList') || '[]'),
      myPlan: JSON.parse(localStorage.getItem('myPlan') || '[]'),

      init() {
        this.cacheElements();
        this.bindEvents();
        this.getLocation();
        this.loadFacts();
      },

      cacheElements() {
        this.factCardsWrapper = document.getElementById('factCardsWrapper');
        this.factTitle = document.getElementById('factTitle');
        this.factWidget = document.getElementById('factWidget');
        this.toggleFactsBtn = document.getElementById('toggleFacts');
        this.resultsList = document.getElementById('resultsList');
      },

      bindEvents() {
        document.getElementById('toggleFacts').addEventListener('click', () => {
          this.factWidget.classList.toggle('collapsed');
          this.toggleFactsBtn.classList.toggle('rotated');
        });

        document.getElementById('prevFact').addEventListener('click', () => this.showPrevFact());
        document.getElementById('nextFact').addEventListener('click', () => this.showNextFact());

        document.querySelectorAll('.filter-btn').forEach(btn =>
          btn.addEventListener('click', e => this.searchPlaces(e.target.dataset.type))
        );

        document.getElementById('myListBtn').addEventListener('click', () => this.showList());
        document.getElementById('myPlanBtn').addEventListener('click', () => this.showPlan());
        document.getElementById('surpriseBtn').addEventListener('click', () => this.randomPlace());
        document.getElementById('supportBtn').addEventListener('click', () => this.openModal('supportModal'));
        document.getElementById('ghostBtn').addEventListener('click', () => this.openModal('ghostMenu'));

        // Modal close buttons
        document.querySelectorAll('.close-btn').forEach(btn =>
          btn.addEventListener('click', e => e.target.closest('.modal').classList.remove('active'))
        );

        // Ghost menu actions
        document.getElementById('ghostList').addEventListener('click', e => {
          const action = e.target.dataset.action;
          if (action === 'about') alert('Local Explorer v1.0 ‚Äî Discover nearby gems.');
          if (action === 'theme') document.body.classList.toggle('dark');
          if (action === 'reset') this.resetData();
        });
      },

      getLocation() {
        const display = document.getElementById('locationDisplay');
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            position => {
              this.pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
              display.textContent = `üìç ${this.pos.lat.toFixed(3)}, ${this.pos.lng.toFixed(3)}`;
              this.initMap();
            },
            () => {
              display.textContent = '‚ö†Ô∏è Location blocked. Use manual entry.';
              document.getElementById('manualInputContainer').style.display = 'block';
            }
          );
        } else {
          display.textContent = 'Geolocation not supported.';
        }
      },

      initMap() {
        this.map = new google.maps.Map(document.createElement('div'), {
          center: this.pos,
          zoom: 15
        });
        this.service = new google.maps.places.PlacesService(this.map);
      },

      searchPlaces(type) {
        if (!this.service || !this.pos) return alert('Waiting for location‚Ä¶');
        const request = {
          location: this.pos,
          radius: 2500,
          type: [type]
        };
        this.service.nearbySearch(request, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            this.places = results;
            this.showResults();
          } else alert('No results found.');
        });
      },

      showResults() {
        const modal = document.getElementById('resultsModal');
        modal.classList.add('active');
        const list = this.resultsList;
        list.innerHTML = '';
        this.places.forEach(p => {
          const item = document.createElement('button');
          item.className = 'results-item';
          const photo = p.photos ? p.photos[0].getUrl({ maxWidth: 80 }) : 'icon-192.png';
          item.innerHTML = `
            <img src="${photo}" alt="">
            <div class="results-info">
              <h4>${p.name}</h4>
              <span class="rating">${p.rating ? '‚≠ê ' + p.rating : ''}</span>
            </div>
          `;
          item.onclick = () => this.showDetails(p);
          list.appendChild(item);
        });
      },

      showDetails(place) {
        const modal = document.getElementById('detailsModal');
        modal.classList.add('active');
        document.getElementById('detailTitle').textContent = place.name;
        const body = document.getElementById('detailBody');
        const address = place.vicinity || place.formatted_address || 'No address available';
        const rating = place.rating ? `‚≠ê ${place.rating}` : 'No rating';
        body.innerHTML = `
          <p>${address}</p>
          <p>${rating}</p>
          <button onclick="LocalExplorer.addToList('${place.name}')">‚ûï Save to My List</button>
          <button onclick="LocalExplorer.addToPlan('${place.name}')">üóìÔ∏è Add to Plan</button>
        `;
      },

      addToList(name) {
        if (!this.savedList.includes(name)) {
          this.savedList.push(name);
          localStorage.setItem('savedList', JSON.stringify(this.savedList));
        }
        alert(`${name} added to My List.`);
      },

      addToPlan(name) {
        if (!this.myPlan.includes(name)) {
          this.myPlan.push(name);
          localStorage.setItem('myPlan', JSON.stringify(this.myPlan));
        }
        alert(`${name} added to My Plan.`);
      },

      showList() {
        const modal = document.getElementById('myListModal');
        modal.classList.add('active');
        const container = document.getElementById('myListContainer');
        container.innerHTML = this.savedList.length
          ? this.savedList.map(i => `<p>üìç ${i}</p>`).join('')
          : '<p>No saved items yet.</p>';
      },

      showPlan() {
        const modal = document.getElementById('myPlanModal');
        modal.classList.add('active');
        const container = document.getElementById('myPlanContainer');
        container.innerHTML = this.myPlan.length
          ? this.myPlan.map(i => `<p>üóìÔ∏è ${i}</p>`).join('')
          : '<p>No plan yet.</p>';
      },

      randomPlace() {
        const types = ['restaurant', 'cafe', 'park', 'museum', 'shopping_mall', 'tourist_attraction'];
        const type = types[Math.floor(Math.random() * types.length)];
        this.searchPlaces(type);
      },

      openModal(id) {
        document.getElementById(id).classList.add('active');
      },

      resetData() {
        localStorage.clear();
        alert('Local Explorer data cleared.');
        location.reload();
      },

      async loadFacts() {
        const localFacts = [
          "Some cities ban chewing gum for cleanliness.",
          "There‚Äôs a town named 'Boring' in Oregon.",
          "In Japan, square watermelons exist ‚Äî purely aesthetic.",
          "Venice has more bridges than any other city in Europe.",
          "The shortest street in the world is only 2.06 meters long."
        ];
        this.facts = localFacts;
        this.renderFacts();
      },

      renderFacts() {
        this.factCardsWrapper.innerHTML = this.facts
          .map(f => `<div class='fact-card'>${f}</div>`)
          .join('');
        this.currentFact = 0;
      },

      showPrevFact() {
        if (this.facts.length === 0) return;
        this.currentFact = (this.currentFact - 1 + this.facts.length) % this.facts.length;
        this.scrollFacts();
      },

      showNextFact() {
        if (this.facts.length === 0) return;
        this.currentFact = (this.currentFact + 1) % this.facts.length;
        this.scrollFacts();
      },

      scrollFacts() {
        this.factCardsWrapper.style.transform = `translateX(-${this.currentFact * 100}%)`;
      }
    };

    // Initialize app after Maps API loads
    function initApp() {
      LocalExplorer.init();
    }

    // Load Google Maps dynamically
    (function() {
      const script = document.createElement('script');
      const key = window.MAPS_API_KEY || '';
      script.src = `https://maps.googleapis.com/maps/api/js?key=${key}&libraries=places&callback=initApp`;
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>
